<?php /**   * Rechte setzten   * @author Stefan Seehafer aka imagine (fanpress@nobody-knows.org)   * @copyright 2011-2014   *   */    if(!defined("LOGGED_IN_USER")) { die(); }    if(LOGGED_IN_USER && fpSecurity::checkPermissions ("permissions")) {        ?><h2><?php fpLanguage::printLanguageConstant(LANG_SYSCFG_PERMISSIONS) ?></h2><?php        if(isset($_POST["sbmupdperm"])) {                        $permissionConfArray = $_POST['perm'];                        array_map('intval', $permissionConfArray);            foreach($permissionConfArray AS $group => $permissionConfRow) {                array_map('intval', $permissionConfRow);                $fpUser->updatePermissions($group,$permissionConfRow);            }            fpMessages::showSysNotice(LANG_PERM_EDITMSG);        }                        $rolls = $fpUser->getUsrLevels();                $result   = fpSecurity::getPermissionsConfig();          foreach ($fpDBcon->fetch($result, true) as $permRow) {            $permissionArray[$permRow->author_level_id] = unserialize($permRow->permissions);            $permissionArray[$permRow->author_level_id] = array_map('intval', $permissionArray[$permRow->author_level_id]);        }?>    <form method="post" action="sysconfig.php?mod=permissions">        <div id="tabsGeneral">            <ul>                <li><a href="#tabs-permissions-news"><?php fpLanguage::printLanguageConstant(LANG_PERM_NEWS); ?></a></li>                <li><a href="#tabs-permissions-comments"><?php fpLanguage::printLanguageConstant(LANG_PERM_COMMENTS); ?></a></li>                <li><a href="#tabs-permissions-uploads"><?php fpLanguage::printLanguageConstant(LANG_UPLOAD_FILEMANAGER); ?></a></li>                <li><a href="#tabs-permissions-system"><?php fpLanguage::printLanguageConstant(LANG_PERM_SYS); ?></a></li>                <li><a href="#tabs-permissions-modules"><?php fpLanguage::printLanguageConstant(LANG_PERM_MODULES); ?></a></li>            </ul>                        <div id="tabs-permissions-news">                <table width="100%" border="0">                    <tr class="permissionsContent">                        <td class="tdheadline2 permissionsHeadline"><strong><?php fpLanguage::printLanguageConstant(LANG_PERM_ULVL); ?></strong></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_ADDNEWS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_EDITNEWS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_DELETENEWS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_EDITNEWSARCHIVED); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_EDITNEWSOTHER); ?></td>                    </tr>        <?php foreach($rolls AS $row) : ?>                    <tr class="permissionsContent">                              <td><?php print fpLanguage::replaceDBDataByLanguageData(htmlspecialchars_decode($row->leveltitle), $langReplaceDataArray); ?></td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][addnews]">                                <option value="0" <?php if($permissionArray[$row->id]['addnews'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['addnews'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][editnews]">                                <option value="0" <?php if($permissionArray[$row->id]['editnews'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['editnews'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][deletenews]">                                <option value="0" <?php if($permissionArray[$row->id]['deletenews'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['deletenews'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][editnewsarchive]">                                <option value="0" <?php if($permissionArray[$row->id]['editnewsarchive'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['editnewsarchive'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][editallnews]">                                <option value="0" <?php if($permissionArray[$row->id]['editallnews'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['editallnews'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                            </tr>        <?php endforeach; ?>                  </table>                            </div>            <div id="tabs-permissions-comments">                <table width="100%" border="0">                    <tr class="permissionsContent">                        <td class="tdheadline2 permissionsHeadline"><strong><?php fpLanguage::printLanguageConstant(LANG_PERM_ULVL); ?></strong></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_EDITCOMMENTS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_DELETECOMMENTS); ?></td>                    </tr>        <?php foreach($rolls AS $row) : ?>                    <tr class="permissionsContent">                              <td><?php print fpLanguage::replaceDBDataByLanguageData(htmlspecialchars_decode($row->leveltitle), $langReplaceDataArray); ?></td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][editcomments]">                                <option value="0" <?php if($permissionArray[$row->id]['editcomments'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['editcomments'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][deletecomments]">                                <option value="0" <?php if($permissionArray[$row->id]['deletecomments'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['deletecomments'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                           </tr>        <?php endforeach; ?>                  </table>            </div>                        <div id="tabs-permissions-system">                <table width="100%" border="0">                    <tr class="permissionsContent" style="padding-bottom:10px;">                        <td class="tdheadline2 permissionsHeadline"><strong><?php fpLanguage::printLanguageConstant(LANG_PERM_ULVL); ?></strong></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_USRCONFIG); ?></td>                                <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_SYSCONFIG); ?></td>                          <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_CATCONFIG); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_PERMISSIONS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_TEMPLATES); ?></td>                                   <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_SMILIES); ?></td>                            </tr>        <?php foreach($rolls AS $row) : ?>                    <tr class="permissionsContent">                              <td><?php print fpLanguage::replaceDBDataByLanguageData(htmlspecialchars_decode($row->leveltitle), $langReplaceDataArray); ?></td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][user]">                                <option value="0" <?php if($permissionArray[$row->id]['user'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['user'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][system]">                                <option value="0" <?php if($permissionArray[$row->id]['system'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['system'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][category]">                                <option value="0" <?php if($permissionArray[$row->id]['category'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['category'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect" name="perm[<?php print $row->id; ?>][permissions]" <?php if($row->id == 1) : ?>disabled="disabled"<?php endif; ?>>                                <option value="0" <?php if($permissionArray[$row->id]['permissions'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['permissions'] == 1 || $row->id == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                            <?php if($row->id == 1) : ?><input type="hidden" name="perm[<?php print $row->id; ?>][permissions]" value="1"><?php endif; ?>                        </td>                        <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][templates]">                                <option value="0" <?php if($permissionArray[$row->id]['templates'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['templates'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                <td class="tdtcontent">                            <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][smilies]">                                <option value="0" <?php if($permissionArray[$row->id]['smilies'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['smilies'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                        </tr>        <?php endforeach; ?>                  </table>              </div>                                    <div id="tabs-permissions-uploads">                <table width="100%" border="0">                    <tr class="permissionsContent" style="padding-bottom:10px;">                        <td class="tdheadline2 permissionsHeadline"><strong><?php fpLanguage::printLanguageConstant(LANG_PERM_ULVL); ?></strong></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_UPLOADSADDFILE); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_UPLOADSTHUMBS); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_DELETEUPLOADS); ?></td>                    </tr>        <?php foreach($rolls AS $row) : ?>                    <tr class="permissionsContent">                              <td><?php print fpLanguage::replaceDBDataByLanguageData(htmlspecialchars_decode($row->leveltitle), $langReplaceDataArray); ?></td>                        <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][upload]">                                <option value="0" <?php if($permissionArray[$row->id]['upload'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['upload'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][newthumbs]">                                <option value="0" <?php if($permissionArray[$row->id]['newthumbs'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['newthumbs'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][deletefiles]">                                <option value="0" <?php if($permissionArray[$row->id]['deletefiles'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['deletefiles'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                            </tr>        <?php endforeach; ?>                  </table>               </div>                                    <div id="tabs-permissions-modules">                <table width="100%" border="0">                    <tr class="permissionsContent">                        <td class="tdheadline2 permissionsHeadline"><strong><?php fpLanguage::printLanguageConstant(LANG_PERM_ULVL); ?></strong></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_MODULES_MGR); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_MODULES_ENABLE); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_MODULESINSTALL); ?></td>                        <td class="tdheadline2 permissionsHeadline tdheadlinerights"><?php fpLanguage::printLanguageConstant(LANG_PERM_MODULESUNINSTALL); ?></td>                    </tr>        <?php foreach($rolls AS $row) : ?>                    <tr class="permissionsContent">                              <td><?php print fpLanguage::replaceDBDataByLanguageData(htmlspecialchars_decode($row->leveltitle), $langReplaceDataArray); ?></td>                        <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][modules]">                                <option value="0" <?php if($permissionArray[$row->id]['modules'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['modules'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][moduleendisable]">                                <option value="0" <?php if($permissionArray[$row->id]['moduleendisable'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['moduleendisable'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                                <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][moduleinstall]">                                <option value="0" <?php if($permissionArray[$row->id]['moduleinstall'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['moduleinstall'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                        <td class="tdtcontent">                                        <select class="permissionselect fp-ui-jqselect"  name="perm[<?php print $row->id; ?>][moduleuninstall]">                                <option value="0" <?php if($permissionArray[$row->id]['moduleuninstall'] == 0) { print "selected=\"selected\""; } ?>><?php fpLanguage::printNo(); ?></option>                                <option value="1" <?php if($permissionArray[$row->id]['moduleuninstall'] == 1) { print "selected=\"selected\""; } ?>><?php fpLanguage::printYes(); ?></option>                            </select>                        </td>                                            </tr>        <?php endforeach; ?>                  </table>            </div>                    </div>        <div class="buttons fp-editor-buttons-fixed ui-widget-content ui-corner-all ui-state-normal">            <button type="submit" name="sbmupdperm" class="btnloader fp-ui-button"><?php fpLanguage::printSave(); ?></button>        </div>            </form><?php    } else {        if(!fpSecurity::checkPermissions("permissions")) { fpMessages::showNoAccess(); }            }    ?>  